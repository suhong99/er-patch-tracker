# 시즌 분류 로직 날짜 기반으로 변경

- **날짜**: 2026-01-08
- **브랜치**: feature/27
- **상태**: 완료

---

## 문제 현상

가넷 캐릭터 상세 페이지에서 1.36.1 패치(2024-12-11)가 시즌 9로 잘못 분류됨.

### 원인

`patchVersion` 필드에 날짜가 포함된 형식 존재:

- `"2024.12.12 - 1.36.1 패치노트"`

`parsePatchVersion` 함수가 문자열 시작부터 파싱하여 `2024.12`를 버전으로 인식 → 시즌 9로 오분류

### 영향받는 패치 (7개)

| patchVersion                                       | 올바른 시즌 |
| -------------------------------------------------- | ----------- |
| `2023.07.06 정기 점검 사전 안내 (0.88.0 패치노트)` | 시즌 1 이전 |
| `2024.02.22 - 1.15.1 패치노트`                     | 시즌 3      |
| `2024.05.30 - 1.22.1 패치노트`                     | 시즌 4      |
| `2024.09.05 - 1.29.1 패치노트`                     | 시즌 5      |
| `2024.12.12 - 1.36.1 패치노트`                     | 시즌 6      |
| `2025.01.23 - 1.39.1 패치노트`                     | 시즌 6      |
| `2025.03.27 - 1.43.1 패치노트`                     | 시즌 7      |

---

## 해결 방안

**패치 버전 기반 → 패치 날짜 기반으로 변경**

### 이유

1. `patchDate`는 항상 `YYYY-MM-DD` 형식으로 일관됨
2. `patchVersion` 형식 불일치 문제 완전 해결
3. 성능 차이 없음

### 수정 대상

- `src/lib/seasons.ts`
  - `getSeasonByPatchVersion` → `getSeasonByDate` 로 변경 또는 추가
  - `groupPatchesBySeason` - patchDate 사용하도록 수정
  - `getSeasonsFromPatches` - patchDate 사용하도록 수정

- 호출부 수정 (필요시)
  - `src/app/character/[name]/page.tsx`

---

## 작업 단계

- [x] 원인 분석
- [x] `getSeasonByDate` 함수 구현
- [x] `groupPatchesBySeason` 수정 (patchDate 사용)
- [x] `getSeasonsFromPatches` 수정 (patchDate 사용)
- [x] 호출부 확인 및 수정 (수정 불필요 - PatchEntry에 patchDate 있음)
- [x] 빌드 및 테스트 ✅ 성공
- [ ] 가넷 페이지에서 1.36.1 패치가 시즌 6으로 표시되는지 확인 (사용자 확인 필요)

---

## 수정된 파일

### `src/lib/seasons.ts`

1. `getSeasonByDate(patchDate: string)` 함수 추가
   - YYYY-MM-DD 형식 날짜를 받아 시즌 반환
   - 최신 시즌부터 역순으로 startDate 비교

2. `groupPatchesBySeason` 수정
   - 제네릭 타입: `{ patchVersion: string }` → `{ patchDate: string }`
   - 내부에서 `getSeasonByDate(patch.patchDate)` 사용

3. `getSeasonsFromPatches` 수정
   - 제네릭 타입: `{ patchVersion: string }` → `{ patchDate: string }`
   - 내부에서 `getSeasonByDate(patch.patchDate)` 사용

4. `getSeasonByPatchVersion`에 `@deprecated` 주석 추가

5. `getSeasonEndDate(season: Season)` 함수 추가
   - 다음 시즌 시작일 - 1일을 종료일로 반환
   - 현재 시즌이면 null 반환

### `src/app/character/[name]/page.tsx`

- 시즌 날짜 표시 수정: `2024-12 ~ 2024` → `2024-12-05 ~ 2025-03-19`
- `getSeasonEndDate` 함수 import 및 사용
